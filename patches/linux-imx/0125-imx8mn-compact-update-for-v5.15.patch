From 8380e4643ade00f4c036dacfbe81a3cb7658a345 Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Mon, 22 Apr 2024 14:09:18 +0200
Subject: [PATCH] imx8mn-compact: update for v5.15

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 arch/arm64/boot/dts/freescale/imx8mn-compact.dts | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/imx8mn-compact.dts b/arch/arm64/boot/dts/freescale/imx8mn-compact.dts
index e2b8c17acb2a..465ff1f358a0 100755
--- a/arch/arm64/boot/dts/freescale/imx8mn-compact.dts
+++ b/arch/arm64/boot/dts/freescale/imx8mn-compact.dts
@@ -734,8 +734,6 @@ &uart4 { /* U-BLOX Nina B1 */
 	pinctrl-0 = <&pinctrl_uart4>;
 	assigned-clocks = <&clk IMX8MN_CLK_UART4>;
 	assigned-clock-parents = <&clk IMX8MN_SYS_PLL1_80M>;
-	/delete-property/ dmas;
-        /delete-property/ dmas-names;
 	resets = <&ublox_reset>;
         status = "okay";
 };
@@ -803,13 +801,18 @@ &ecspi2 {
 	#size-cells = <0>;
 	
         can0: can@0 {
-		clocks = <&clk24m>;
-                compatible = "microchip,mcp25xxfd";
+                compatible = "microchip,mcp251xfd";
                 pinctrl-names = "default";
                 reg = <0>;
 		spi-max-frequency = <20000000>;
 		interrupt-parent = <&gpio5>;
                 interrupts = <1 IRQ_TYPE_EDGE_FALLING>;
+		clocks = <&clk IMX8MN_CLK_CLKOUT1>;
+		/* generate 8MHz clock from soc-internal 24mhz reference */
+		assigned-clocks = <&clk IMX8MN_CLK_CLKOUT1_SEL>,
+			  <&clk IMX8MN_CLK_CLKOUT1_DIV>;
+		assigned-clock-rates = <0>, <8000000>;
+		assigned-clock-parents = <&clk IMX8MN_CLK_24M>, <0>;
         };
 
 };
-- 
2.35.3

